import{r as o,j as e,Q as b,a as l,S as y}from"./app-cwKvjecJ.js";import{A as v,T as k}from"./AuthenticatedLayout-gkY4RZHY.js";import"./transition-PBUkRdM8.js";import"./Modal-CLfweMmt.js";import"./PrimaryButton-LaDYYdJ4.js";function $({auth:x}){const[S,N]=o.useState([]),[c,h]=o.useState(""),[p,C]=o.useState([]),[d,u]=o.useState(!1),[P,R]=o.useState(!0),[m,g]=o.useState({show:!1,message:"",type:"success"});o.useEffect(()=>{(async()=>{try{await l.get("/sanctum/csrf-cookie");const[a,t]=await Promise.all([l.get("/api/demo/scenarios"),l.get("/api/sensors")]);N(a.data),C(t.data),t.data.length>0&&h(t.data[0].id)}catch(a){console.error("Error fetching data:",a);let t="Failed to load data";a.response&&(a.response.status===401?(t="Session expired. Please log in again.",y.visit("/login")):a.response.status===404?t="Required data not found":a.response.status===419&&(t="Session expired. Refreshing page...",window.location.reload())),n(t,"error")}finally{R(!1)}})()},[]);const n=(s,a="success")=>{g({show:!0,message:s,type:a}),setTimeout(()=>g({show:!1,message:"",type:"success"}),3e3)},D=async s=>{var a,t,f,j;if(!c){n("Please select a sensor first","error");return}u(!0);try{const r=(await l.post("/api/demo/trigger-scenario",{scenario_name:s,sensor_id:c})).data,w=r.risk_level,_=`Scenario triggered: ${w} - ${r.explanation}`;n(_,w==="Critical"?"error":"success")}catch(i){console.error("Error triggering scenario:",i);let r="Failed to trigger scenario";((a=i.response)==null?void 0:a.status)===401?(r="Session expired. Please log in again.",y.visit("/login")):((t=i.response)==null?void 0:t.status)===419?(r="Session expired. Refreshing page...",window.location.reload()):(j=(f=i.response)==null?void 0:f.data)!=null&&j.error&&(r=i.response.data.error),n(r,"error")}finally{u(!1)}};return P?e.jsxs(v,{user:x.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Demo Control Panel"}),children:[e.jsx(b,{title:"Demo Control Panel"}),e.jsx("div",{className:"py-0",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-0",children:e.jsx("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg p-6",children:e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"}),e.jsx("span",{className:"ml-2",children:"Loading..."})]})})})})]}):e.jsxs(v,{user:x.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Demo Control Panel"}),children:[e.jsx(b,{title:"Demo Control Panel"}),e.jsx("div",{className:"py-0",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-0",children:e.jsx("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg p-6",children:p.length===0?e.jsx("div",{className:"text-center text-gray-600",children:e.jsx("p",{children:"No sensors available. Please add sensors to use the demo features."})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Sensor"}),e.jsx("select",{value:c,onChange:s=>h(s.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:p.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.location," (",s.type,")"]},s.id))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:S.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 hover:shadow-lg transition-shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s.scenario_name.split("_").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ")}),e.jsx("p",{className:"text-gray-600 mb-4",children:s.description}),e.jsx("button",{onClick:()=>D(s.scenario_name),disabled:d,className:`w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition-colors ${d?"opacity-50 cursor-not-allowed":""}`,children:d?"Running...":"Run Scenario"})]},s.scenario_name))})]})})})}),m.show&&e.jsx(k,{message:m.message,type:m.type,onClose:()=>g({show:!1,message:"",type:"success"})})]})}export{$ as default};
