import{r,j as e,Q as T,a as h}from"./app-CPDKVT9Z.js";import{A as Q}from"./AuthenticatedLayout-D2IqHuTU.js";import{T as W}from"./TextInput-C97rrFg7.js";import{P as q}from"./PrimaryButton-BkCMJnGa.js";import"./transition-B1brDaxg.js";h.defaults.withCredentials=!0;h.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const M=["What's the air quality in Sector B?","Are there any sensors offline right now?","Show me recent critical alerts","What's the temperature trend in the storage area?","When was the last safety inspection?","What's the robot's current location?"];function G({auth:_}){const[y,o]=r.useState([{role:"assistant",content:"Hello! I'm SAFE AI, your expert assistant for the factory monitoring system. How can I help you today?"}]),[c,x]=r.useState(""),[m,p]=r.useState(!1),[u,E]=r.useState(null),[f,j]=r.useState(null),[l,C]=r.useState(null),[v,b]=r.useState(null),N=r.useRef(null),S=r.useRef(null),w=async()=>{var s,a,i;console.log("Fetching system summary...");try{const n=await h.get("/api/ai-assistant/summary");console.log("System summary response:",n.data),C(n.data),b(null)}catch(n){console.error("Failed to fetch system summary:",{error:n,response:(s=n.response)==null?void 0:s.data,status:(a=n.response)==null?void 0:a.status,headers:(i=n.response)==null?void 0:i.headers}),b("Failed to load system summary")}};r.useEffect(()=>{console.log("Setting up system summary polling"),w();const s=setInterval(w,3e4);return()=>{console.log("Cleaning up system summary polling"),clearInterval(s)}},[]);const L=()=>{var s;(s=N.current)==null||s.scrollIntoView({behavior:"smooth"})};r.useEffect(()=>{console.log("Messages updated, scrolling to bottom"),L()},[y]);const R=s=>{var a;console.log("Suggested question selected:",s),x(s),(a=S.current)==null||a.focus()},I=async s=>{var i,n,A;if(s.preventDefault(),!c.trim()||m)return;const a=c.trim();console.log("Submitting chat message:",{message:a,conversationId:u}),x(""),j(null),o(t=>[...t,{role:"user",content:a}]),p(!0),o(t=>[...t,{role:"assistant",content:"...",isLoading:!0}]);try{console.log("Sending chat request to API...");const t=await h.post("/api/ai-assistant/chat",{message:a,conversation_id:u});console.log("Chat API response:",{data:t.data,status:t.status,headers:t.headers}),o(d=>d.filter(g=>!g.isLoading)),o(d=>[...d,{role:"assistant",content:t.data.message}]),!u&&t.data.conversation_id&&(console.log("Setting new conversation ID:",t.data.conversation_id),E(t.data.conversation_id))}catch(t){console.error("Chat API request failed:",{error:t,response:(i=t.response)==null?void 0:i.data,status:(n=t.response)==null?void 0:n.status,headers:(A=t.response)==null?void 0:A.headers,message:a,conversationId:u}),o(d=>d.filter(g=>!g.isLoading)),j("Failed to get response. Please try again.")}finally{p(!1)}},P=s=>{x(s.target.value)},D=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),I(s))},F=s=>{switch(s){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs(Q,{user:_.user,header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"AI Assistant"}),children:[e.jsx(T,{title:"AI Assistant"}),e.jsx("div",{className:"py-0",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-0",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"flex flex-col h-[calc(100vh-200px)]",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[y.map((s,a)=>e.jsx("div",{className:`flex ${s.role==="user"?"justify-end":"justify-start"}`,children:e.jsx("div",{className:`max-w-[80%] rounded-lg p-4 ${s.role==="user"?"bg-blue-500 text-white":"bg-gray-100 text-gray-900"}`,children:s.isLoading?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}):e.jsx("div",{className:"whitespace-pre-wrap",children:s.content})})},a)),e.jsx("div",{ref:N})]}),f&&e.jsx("div",{className:"px-6 py-2 bg-red-50 border-t border-red-100",children:e.jsx("p",{className:"text-red-600 text-sm",children:f})}),e.jsx("div",{className:"border-t border-gray-200 p-4",children:e.jsxs("form",{onSubmit:I,className:"flex space-x-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(W,{ref:S,type:"text",value:c,onChange:P,onKeyPress:D,placeholder:"Type your message here...",className:"w-full",disabled:m})}),e.jsx(q,{type:"submit",disabled:m||!c.trim(),children:m?"Sending...":"Send"})]})})]})})}),e.jsxs("div",{className:"w-80 space-y-6",children:[e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsx("h3",{className:"font-semibold text-gray-900",children:"System Summary"})}),e.jsx("div",{className:"p-4 space-y-4",children:v?e.jsx("p",{className:"text-red-600 text-sm",children:v}):l?e.jsxs(e.Fragment,{children:[l.latest_alert&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Latest Alert"}),e.jsxs("div",{className:`text-sm p-2 rounded ${F(l.latest_alert.severity)}`,children:[l.latest_alert.type," - ",l.latest_alert.location,e.jsx("div",{className:"text-xs mt-1 text-gray-600",children:l.latest_alert.created_at})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Offline Sensors"}),e.jsxs("p",{className:"text-sm mt-1",children:[l.offline_sensors_count," sensors currently offline"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Robot Status"}),e.jsx("p",{className:"text-sm mt-1",children:l.robot_status})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Last AI Recommendation"}),e.jsx("p",{className:"text-sm mt-1",children:l.last_recommendation})]})]}):e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]})})]}),e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsx("h3",{className:"font-semibold text-gray-900",children:"Suggested Questions"})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"space-y-2",children:M.map((s,a)=>e.jsx("button",{onClick:()=>R(s),className:"w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded-lg transition-colors duration-150",children:s},a))})})]})]})]})})})]})}export{G as default};
