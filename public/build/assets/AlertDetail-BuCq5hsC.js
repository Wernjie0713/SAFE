import{j as e,r as g,J as N,Q as b,S as j,a as w}from"./app-cwKvjecJ.js";import{A,T as S}from"./AuthenticatedLayout-gkY4RZHY.js";import{P as k}from"./PrimaryButton-LaDYYdJ4.js";import{S as f}from"./SecondaryButton-IMRNar0o.js";import"./transition-PBUkRdM8.js";import"./Modal-CLfweMmt.js";function L({summary:x,suggestions:s,isLoading:o,error:m}){const y=a=>{if(!a)return{severity:"N/A",detectedValue:"N/A",threshold:"N/A",location:"N/A"};let r={severity:"N/A",detectedValue:"N/A",threshold:"N/A",location:"N/A"};const l=a.match(/(?:critical|high|medium|low)/i);l&&(r.severity=l[0].charAt(0).toUpperCase()+l[0].slice(1));const n=a.match(/(\d+(?:\.\d+)?)\s*(?:ppm|°C|%|mg\/m³)/i);n&&(r.detectedValue=n[0]);const p=a.match(/(?:in|at)\s+(Sector\s+[A-Z]|Area\s+\d+|Zone\s+\d+)/i);return p&&(r.location=p[1]),r},h=a=>{if(!a)return[];if(Array.isArray(a))return a;const r=String(a);try{const l=JSON.parse(r);return Array.isArray(l)?l:[r]}catch{return r.split(/(?:\d+\.|•|\n-|\n\*)/g).map(n=>n.trim()).filter(n=>n.length>0)}},t=y(x),c=s?h(s):[];return o?e.jsxs("div",{className:"space-y-4 animate-pulse",children:[e.jsx("div",{className:"h-32 bg-gray-200 rounded-lg"}),e.jsx("div",{className:"h-40 bg-gray-200 rounded-lg"})]}):m?e.jsx("div",{className:"rounded-lg bg-red-50 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error Loading AI Analysis"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:m})]})]})}):!x&&!s?e.jsx("div",{className:"rounded-lg bg-gray-50 p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-800",children:"No AI Analysis Available"}),e.jsx("div",{className:"mt-2 text-sm text-gray-600",children:"AI analysis has not been generated for this alert yet."})]})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gradient-to-r from-blue-50 to-transparent border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"ml-2 text-sm font-semibold text-gray-900",children:"Incident Summary"})]})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase",children:"Severity"}),e.jsx("div",{className:"mt-1 font-medium text-gray-900",children:t.severity})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase",children:"Location"}),e.jsx("div",{className:"mt-1 font-medium text-gray-900",children:t.location})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase",children:"Detected Value"}),e.jsx("div",{className:"mt-1 font-medium text-gray-900",children:t.detectedValue})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 uppercase",children:"Threshold"}),e.jsx("div",{className:"mt-1 font-medium text-gray-900",children:t.threshold})]})]}),e.jsx("div",{className:"text-sm text-gray-600 leading-relaxed",children:x})]})]}),c.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 bg-gradient-to-r from-blue-50 to-transparent border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),e.jsx("h3",{className:"ml-2 text-sm font-semibold text-gray-900",children:"Suggested Actions"})]})}),e.jsx("div",{className:"p-4",children:e.jsx("ol",{className:"space-y-4",children:c.map((a,r)=>e.jsxs("li",{className:"flex items-start group",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center rounded-full bg-blue-50 group-hover:bg-blue-100 transition-colors duration-150",children:e.jsx("span",{className:"text-sm font-medium text-blue-600",children:r+1})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"h-5 w-5 text-blue-500 opacity-0 group-hover:opacity-100 transition-opacity duration-150",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:a})]}),e.jsx("div",{className:"mt-1 h-px bg-gray-100 group-hover:bg-blue-100 transition-colors duration-150"})]})]},r))})})]})]})}const C=w.create({headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":"application/json",Accept:"application/json"},withCredentials:!0});function P({auth:x,alert:s}){const[o,m]=g.useState(!1),[y,h]=g.useState(!1),{flash:t}=N().props,[c,a]=g.useState({summary:s.ai_summary,suggestion:s.ai_suggestion,loading:!1,error:null});g.useEffect(()=>{if(t!=null&&t.success){h(!0);const i=setTimeout(()=>h(!1),3e3);return()=>clearTimeout(i)}},[t==null?void 0:t.success]),g.useEffect(()=>{(async()=>{if(!s.ai_summary){a(d=>({...d,loading:!0,error:null}));try{const d=await C.post(`/api/alerts/${s.id}/generate-summary`);a({summary:d.data.ai_summary,suggestion:d.data.ai_suggestion,loading:!1,error:null})}catch(d){console.error("Failed to generate AI summary:",d);let u="Failed to generate AI summary. Please try again later.";if(d.response)switch(d.response.status){case 401:u="Authentication required. Please refresh the page and try again.";break;case 403:u="You do not have permission to perform this action.";break;case 429:u="Too many requests. Please wait a moment and try again.";break;case 500:u="Server error occurred while generating summary.";break}a(v=>({...v,loading:!1,error:u}))}}})()},[s.id,s.ai_summary]);const r=i=>{m(!0),j.patch(route("alerts.update",s.id),{status:i},{onSuccess:()=>{m(!1)},onError:()=>{m(!1)},preserveScroll:!0})},l=i=>{switch(i){case"critical":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},n=i=>{switch(i){case"online":return"bg-green-100 text-green-800";case"offline":return"bg-red-100 text-red-800";case"maintenance":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},p=i=>i>=75?"bg-green-100 text-green-800":i>=25?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800";return e.jsxs(A,{user:x.user,header:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Alert Details"}),e.jsx(f,{onClick:()=>j.visit(route("reports.history")),children:"Back"})]}),children:[e.jsx(b,{title:"Alert Details"}),y&&(t==null?void 0:t.success)&&e.jsx(S,{message:t.success,type:"success",onClose:()=>h(!1)}),e.jsx("div",{className:"py-0",children:e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-0",children:e.jsxs("div",{className:"bg-white overflow-hidden shadow-sm sm:rounded-lg",children:[e.jsx("div",{className:"border-b border-gray-200 bg-gray-50 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${l(s.severity)}`,children:s.severity.toUpperCase()}),e.jsx("span",{className:"text-lg font-medium text-gray-900",children:s.type})]}),e.jsx("div",{className:"text-sm text-gray-500",children:s.created_at_diff})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Description"}),e.jsx("p",{className:"text-gray-600",children:s.description})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Timeline"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Created:"}),e.jsx("span",{className:"text-gray-900",children:s.created_at})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Last Updated:"}),e.jsx("span",{className:"text-gray-900",children:s.updated_at})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"Status:"}),e.jsx("span",{className:"font-medium capitalize",children:s.status})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Sensor Information"}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Name"}),e.jsx("p",{className:"font-medium",children:s.sensor.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Type"}),e.jsx("p",{className:"font-medium",children:s.sensor.type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Location"}),e.jsx("p",{className:"font-medium",children:s.sensor.location})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Status"}),e.jsx("span",{className:`inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium ${n(s.sensor.status)}`,children:s.sensor.status.toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Battery Level"}),e.jsxs("span",{className:`inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium ${p(s.sensor.battery_level)}`,children:[s.sensor.battery_level,"%"]})]})]})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"AI Summary & Suggestions"}),e.jsx(L,{summary:c.summary,suggestions:c.suggestion,isLoading:c.loading,error:c.error})]}),s.status==="new"&&e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(k,{onClick:()=>r("acknowledged"),disabled:o,children:o?"Processing...":"Acknowledge Alert"}),e.jsx(f,{onClick:()=>r("resolved"),disabled:o,children:o?"Processing...":"Mark as Resolved"})]})]})]})})})]})}export{P as default};
